/**
 * Class Backend
 *
 * Provide methods to handle back end tasks.
 * Special functions for DC_General
 *
 * @copyright  The MetaModels team.
 * @author     Stefan Heimes <cms@men-at-work.de>
 */
var BackendGeneral={loadSubTree:function(a,c){a.blur();var g=c.toggler,f=c.level,e=c.mode,b=$(g),d=$(a).getFirst("img");c.action="DcGeneralLoadSubTree";c.REQUEST_TOKEN=Contao.request_token;if(b){if(b.getStyle("display")=="none"){b.setStyle("display","inline");d.src=d.src.replace("folPlus.gif","folMinus.gif");$(a).store("tip:title",Contao.lang.collapse);new Request.Contao({field:a}).post(c)}else{b.setStyle("display","none");d.src=d.src.replace("folMinus.gif","folPlus.gif");$(a).store("tip:title",Contao.lang.expand);new Request.Contao({field:a}).post(c)}return false}new Request.Contao({field:a,evalScripts:true,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" â€¦"),onSuccess:function(i,k){var h=new Element("li",{id:g,"class":"parent",styles:{display:"inline"}});var j=new Element("ul",{"class":"level_"+f,html:i}).inject(h,"bottom");if(e==5){h.inject($(a).getParent("li"),"after")}else{var m=false,l=$(a).getParent("li");while(typeOf(l)=="element"&&(next=l.getNext("li"))){l=next;if(l.hasClass("tl_folder")){m=true;break}}if(m){h.inject(l,"before")}else{h.inject(l,"after")}}h.getElements("a").each(function(n){n.href=n.href.replace(/&ref=[a-f0-9]+/,"&ref="+Contao.referer_id)});$(a).store("tip:title",Contao.lang.collapse);d.src=d.src.replace("folPlus.gif","folMinus.gif");window.fireEvent("structure");AjaxRequest.hideBox();window.fireEvent("ajax_change")}}).post(c);return false},toggleVisibility:function(f,e,d){f.blur();if(!e){e="visible.gif"}if(!d){d="invisible.gif"}var a=null,g=$(f).getFirst("img"),c=(g.src.indexOf(d)!=-1),h=f.getParent("div"),b;new Request.Contao({url:$(f).href,followRedirects:false,onSuccess:function(){if(h.hasClass("tl_right")){a=h.getPrevious("div").getElement("img")}else{if(h.hasClass("tl_listing_container")){a=f.getParent("td").getPrevious("td").getFirst("div.list_icon");if(a==null){a=f.getParent("td").getPrevious("td").getElement("div.cte_type")}if(a==null){a=f.getParent("tr").getFirst("td").getElement("div.list_icon_new")}}else{if((b=h.getNext("div"))&&b.hasClass("cte_type")){a=b}}}if(a!=null){if(a.nodeName.toLowerCase()=="img"){if(a.getParent("ul.tl_listing").hasClass("tl_tree_xtnd")){if(c){a.src=a.src.replace(/_\.(gif|png|jpe?g)/,".$1")}else{a.src=a.src.replace(/\.(gif|png|jpe?g)/,"_.$1")}}else{if(a.src.match(/folPlus|folMinus/)){if(a.getParent("a").getNext("a")){a=a.getParent("a").getNext("a").getFirst("img")}else{a=new Element("img")}}var i;if(c){i=a.src.replace(/.*_([0-9])\.(gif|png|jpe?g)/,"$1");a.src=a.src.replace(/_[0-9]\.(gif|png|jpe?g)/,((i.toInt()==1)?"":"_"+(i.toInt()-1))+".$1")}else{i=a.src.replace(/.*_([0-9])\.(gif|png|jpe?g)/,"$1");a.src=a.src.replace(/(_[0-9])?\.(gif|png|jpe?g)/,((i==a.src)?"_1":"_"+(i.toInt()+1))+".$2")}}}else{if(a.hasClass("cte_type")){if(c){a.addClass("published");a.removeClass("unpublished")}else{a.addClass("unpublished");a.removeClass("published")}}else{if(c){a.setStyle("background-image",a.getStyle("background-image").replace(/_\.(gif|png|jpe?g)/,".$1"))}else{a.setStyle("background-image",a.getStyle("background-image").replace(/\.(gif|png|jpe?g)/,"_.$1"))}}}}if(c){g.src=g.src.replace(d,e)}else{g.src=g.src.replace(e,d)}}}).get({state:(c?1:0)});return false}};